# Codex configuration file
# See: https://github.com/openai/codex/blob/main/docs/config.md

# Approval policy: when to prompt for approval
# Options: "untrusted", "on-failure", "on-request", "never"
approval_policy = "never"

# Sandbox mode: controls what commands can access
# Options: "read-only", "workspace-write", "danger-full-access"
sandbox_mode = "workspace-write"

[sandbox_workspace_write]
# Allow network access in workspace-write mode
network_access = true

# MCP Servers configuration
[mcp_servers.serena]
command = "uvx"
args = ["--from", "git+https://github.com/oraios/serena", "serena", "start-mcp-server", "--context", "codex"]

{{- $isCI := or (env "CI") (env "GITHUB_ACTIONS") }}
[mcp_servers.github]
command = "mcp-proxy"
args = [
  "--transport",
  "streamablehttp",
  "-H",
  "Authorization",
{{- if and (eq .chezmoi.os "darwin") (not $isCI) -}}
  "Bearer {{ onepasswordRead "op://Personal/GitHub PAT/token" }}",
{{- else -}}
  "Bearer YOUR_GITHUB_TOKEN_HERE",
{{- end }}
  "https://api.githubcopilot.com/mcp/",
]
